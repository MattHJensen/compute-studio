{% extends 'base.html' %}

{% load static %}

{% load strings %}
{% load inputs %}
{% block content %}

<form class="inputs-form" id="inputs-form" method="post" action="{{app_url}}">
{% csrf_token %}
<input type="hidden" name="has_errors" value="{{ has_errors }}" />
<div class="container">
  <div class="row">
    <div class="col">
      <div class="jumbotron shadow" style="background-color:white;">
          <h1 class="display-5"><a class="primary-text" href="{{ app_url }}">{{ owner }}/{{ project_name }}</a> <a href="{{app_url}}detail/" class="btn btn-sm btn-outline-primary">publish details</a></h1>
          <p class="lead">{{app_oneliner}}</p>
          <hr class="my-4">
          <div>{{app_description}}</div>
          {% block project_context %}
          {% endblock %}
      </div>
    </div>
  </div>
  <!-- Sidebar -->
  <div class="row">
    <div class="col-4">
      <ul class="list-unstyled components">
        <li>
          <div class="card card-body card-outer">
            {% include 'comp/inputs/metaparameters.html' with form=form title="Meta Parameters" %}
            <button type="submit" name="reset" value="true" class="btn btn-block btn-outline-dark" style="margin:10px;margin-left:0px;">Reset</a>
          </div>
        </li>
        <li>
          <div class="card card-body card-outer">
            <!-- <ul class="list-unstyled components"> -->
              {% for section, params in default_form.items %}
              <div class="card card-body card-inner">

                <div class="list-group">
                  <a class="list-group-item list-group-item-action mt-0" href="#{{ section.title }}" style="border:0px; padding:0rem; color:inherit;"><h3 style="color:inherit;">{{ section.title }}</h3></a>
                  {% for param in params %}
                    {% for key, value in param.items %}
                      <a class="list-group-item list-group-item-action" href="#{{ key|make_id }}" style="padding: .3rem 0.5rem; border:0px; color:inherit;">{{ key }}</a>
                    {% endfor %}
                  {% endfor %}
                </div>
              </div>
              {% endfor %}
          </div>
        </li>
        <li>
          <div class="card card-body card-outer">
            <button type="button" class="btn btn-block btn-success" style="margin:10px;margin-left:0px;" data-toggle="modal" data-target="#submitModal">
              <b>Run {% if not provided_free %}({{ exp_cost }}){% endif %}</b>
            </button>
          </div>
        </li>
      </ul>
      <!-- Modal -->
      <div class="modal fade" id="submitModal" tabindex="-1" role="dialog" aria-labelledby="submitModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="submitModalLabel">
                {% if user_can_run %}
                  Are you sure that you want to run this simulation?
                {% else %}
                  {% if not user.is_authenticated %}
                    Sign up
                  {% else %}
                    Add a payment method
                  {% endif %}
                {% endif %}
              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              {% if user_can_run %}
                {% if provided_free %}
                  This model's simulations are sponsored and thus, are free for you.
                {% else %}
                  This simulation will cost {{ exp_cost }}. You will be billed at the end of the monthly billing period.

                {% endif %}
              {% else %}
                {% if not user.is_authenticated %}
                  You must be logged in to run simulations.
                {% else %}
                  You must submit a payment method to run paid simulations.
                {% endif %}
              {% endif %}
              {% if not provided_free %}
              <div class="mt-3">
              {% include 'comp/pricing_collapse.html' with button_name="Pricing"%}
              </div>
              {% endif %}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
              {% if user_can_run %}
                <button type="submit" name="full_calc" value="true" class="btn btn-success">Run simulation</button>
              {% else %}
                {% if not user.is_authenticated %}
                  <a href="{% url 'login' %}" class="btn btn-secondary">Log in</a>
                  <a href="{% url 'signup' %}" class="btn btn-success">Sign up</a>
                {% else %}
                  <a href="{% url 'update_payment' %}" class="btn btn-success">Add payment method</a>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-8">
      <div id="content">
        <!-- <div class="container-fluid" style="min-width: 50rem; max-width: 50rem;"> -->
          <div class="inputs-main">
            {% if form.non_field_errors %}
            <div class="card card-body card-outer">
            {% for error in form.non_field_errors %}
                <div class="alert alert-danger text-center lert-dismissible" role="alert">
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  {{ error }}
                </div>
            {% endfor %}
            </div>
            {% endif %}
            {% for section, params in default_form.items %}
              <div class="card card-body card-outer">
                {% include 'comp/inputs/major_section.html' with title=section.title params=params %}
              </div>
            {% endfor %}
          </div>
        <!-- </div> -->
      </div>
    </div>
  </div>
</div>
</form>
<script src="{% static 'js/core.js' %}"></script>
{% endblock %}
